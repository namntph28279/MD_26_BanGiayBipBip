<html lang="en">

<head>
  <title>Đơn Hàng</title>
  <link rel="stylesheet" href="styles.css">

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <style>


    body {
      margin: 7px auto auto;
    }

    /* Style cho các button */

    /* Style cho bảng sản phẩm */
    .table td {
      vertical-align: middle;
    }

    .table .table-actions a {
      margin-right: 5px;
    }

    .btn-cf {
      outline: unset !important;
    }

    .mess {
      position: relative;
      display: inline-block;
    }

    .mess::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 1px;
      background-color: white;
      transition: width 0.5s ease-in-out;
    }

    .mess:hover::after {
      width: 100%;
    }

    .highcharts-figure,
    .highcharts-data-table table {
      min-width: 320px;
      max-width: 1179px;
      height: 400px;
      margin: 1em auto;
    }
  </style>
</head>

<body class="bg-gray-200">
<div class="flex ">
  <!--Side Navbar-->
  <div class="bg-indigo-900 w-1/6">
    <div class=" bg-indigo-800">
      <div class=" text-xl text-gray-200 uppercase font-bold" style="padding: 33px;">Shop BipBip</div>
    </div>
    <div>
      <a href="/statistic" class=" cursor-pointer mess ml-3 mt-3 w-10/12"
         style="border-bottom-width: 1px; text-decoration: none ">
        <div class="flex" style=" padding: 12px;">
          <div>
            <img class="w-5 h-5" src="analytics.png" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100 ">Thống kê</div>
        </div>
      </a>
      <a href="/home" class=" cursor-pointer mess ml-3 mt-3 w-10/12"
         style=" text-decoration: none ">
        <div class="flex" style=" padding: 12px;">
          <div>
            <img class="w-5 h-5" src="dashboard.png" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100 ">Đơn Hàng</div>
        </div>
      </a>
      <a href="/mess" class="cursor-pointer mess ml-3 mt-3 w-10/12" style="text-decoration: none">
        <div class="flex" style=" padding: 12px;">
          <div>
            <img class="w-5 h-5 " src="messages.png" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100 ">Tin Nhắn</div>
        </div>
      </a>
      <a href="/notifications" class="cursor-pointer mess ml-3 mt-3 w-10/12" style="text-decoration: none">
        <div class="flex" style=" padding: 12px;">
          <div>
            <img class="w-5 h-5" src="notifications.png" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100">Thông báo</div>
        </div>
      </a>
      <a href="/customer" class="cursor-pointer mess ml-3 mt-3 w-10/12" style="display: flex; text-decoration: none">
        <div class="flex" style="padding: 12px;">
          <div>
            <img class="w-5 h-5 " src="iconuser.png" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100 ">Quản Lý người dùng</div>
        </div>
      </a>
      <a href="/warehouse" class="cursor-pointer mess ml-3 mt-3 w-10/12" style="text-decoration: none">
        <div class="flex" style=" padding: 12px;">
          <div>
            <img class="w-5 h-5" src="kho.svg" alt="">
          </div>
          <div class="mx-3 text-sm text-gray-100">Kho Hàng</div>
        </div>
      </a>
    </div>
  </div>
  <!--Side Navbar-->

  <!--Main area-->

  <div class="flex-1">
    <!--Top navbar-->
    <div>

      <div class="bg-white px-2 py-0.5 h-18 flex">
        <div class="left md:w-3/4 sm:w-1/3 flex p-3">
          <img src="person.png" class="w-10 h-10" alt="">
          <span class="block p-2">Admin</span>
        </div>
        <div class="right md:w-1/4 sm:w-2/3 flex" style="justify-content: end;">
          <a href="/login" style=" text-decoration: none; color: black; line-height: 58px; margin-right: 24px; ">Đăng xuất</a>
        </div>
      </div>
    </div>
    <!--Top navbar-->
    <div style="width: 1179px ;margin-left: 45px;">
      <figure class="highcharts-figure">
        <div id="container"></div>
      </figure>

      <div style="display: flex;align-items: center">
        <div>
          Thống kê năm:
        </div>

        <select id="dateYearSelect" name="dateYear" style="outline: none;
    padding: 8px;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 14px;">
          <option>2020</option>
          <option>2021</option>
          <option>2022</option>
          <option>2023</option>
          <option>2024</option>
          <option>2025</option>
          <option>2026</option>
          <option>2027</option>
          <option>2028</option>
          <option>2029</option>
        </select>
      </div>


      <figure class="highcharts-figure">
        <div id="container2"></div>
      </figure>
    </div>


  </div>
</div>

</body>
<script>

  function handleSelectChange(event) {
    var selectedValue = event.target.value;

    sreach(selectedValue)
  }
  var selectElement = document.getElementById("dateYearSelect");
  selectElement.onchange = handleSelectChange;
  selectElement.value = "2023";

  function sreach(year){
    fetch('/statistics/revenue/'+year, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    })
        .then(response => response.json())
        .then(data => {

          let dataAllRevenue = [];
          let dataAllProfit = [];
          for (let i = 0; i < data.length; i++) {
            dataAllRevenue.push(data[i].totalRevenue)
            dataAllProfit.push(data[i].totalProfit)
          }
          highChartColum(year,dataAllRevenue, dataAllProfit)
        })
        .catch(error => {
          console.error(error);
        });
  }


  function loadData() {
    fetch('/statistics/sold-products', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    })
        .then(response => response.json())
        .then(data => {

          let dataAll = [];
          for (let i = 0; i < data.length; i++) {
            dataAll.push({
              name: data[i].name,
              y: parseFloat(data[i].totalDetail)
            })
          }
          highChart(dataAll)
        })
        .catch(error => {
          console.error(error);
        });

    fetch('/statistics/revenue/2023', {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json'
      },
    })
        .then(response => response.json())
        .then(data => {

          let dataAllRevenue = [];
          let dataAllProfit = [];
          for (let i = 0; i < data.length; i++) {
            dataAllRevenue.push(data[i].totalRevenue)
            dataAllProfit.push(data[i].totalProfit)
          }
          highChartColum(2023,dataAllRevenue, dataAllProfit)
        })
        .catch(error => {
          console.error(error);
        });
  }

  loadData()
  //vẽ biểu đồ
  function highChart(dataAll) {
    Highcharts.chart('container', {
      credits: {
        enabled: false
      },
      chart: {
        type: 'pie'
      },
      title: {
        text: ' Top 5 sản phẩm bán chạy'
      },
      tooltip: {
        valueSuffix: '%'
      },
      accessibility: {
        enabled: false,
        point: {
          valueSuffix: '%'
        }
      },
      plotOptions: {
        series: {
          allowPointSelect: true,
          cursor: 'pointer',
          dataLabels: [{
            enabled: true,
            distance: 56
          }]
        },
        pie: {
          allowPointSelect: true,
          borderWidth: 2,
          cursor: 'pointer',
          dataLabels: {
            enabled: true,
            format: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b>',
            distance: 20//độ rộng
          }
        }
      },
      series: [{
        enableMouseTracking: true,//di chuột vào sẽ hiển thị nội dung ben trong
        animation: {
          duration: 2000 //thời gian xuất hiện
        },
        name: 'Tỉ lệ',
        colorByPoint: true,
        data: dataAll
      }]
    });
  }

  function highChartColum(year,dataAllRevenue, dataAllProfit) {
    Highcharts.chart('container2', {
      credits: {
        enabled: false
      },
      accessibility: {
        enabled: false
      },
      chart: {
        type: 'column'
      },
      title: {
        text: ' Doanh số năm ' +year,
      },
      subtitle: {
        text: ' ',
      },
      xAxis: {
        categories: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
        crosshair: true,
        accessibility: {
          description: ''
        }
      },
      yAxis: {
        min: 0,

        title: {
          text: ''
        }
      },
      tooltip: {},
      plotOptions: {
        column: {
          pointPadding: 0.2,
          borderWidth: 0
        }
      },
      series: [
        {
          name: 'Doanh số',
          data: dataAllRevenue
        },

      ]
    });
  }
</script>
</html>